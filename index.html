<html>

<head>
    <link rel="stylesheet" href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css"
        integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous" />
    <script type="module">
        import init, { lookup } from './pkg/senor_borroso.js';
        async function run() {
            await init();
            var textInput = document.getElementById('nameInput');
            const updateTable = function () {
                var input = $("#nameInput").val();
                var before = window.performance.now();
                var l = lookup(input);
                var after = window.performance.now();

                var myList = JSON.parse(l);

                function buildHtmlTable(selector) {
                    var columns = addAllColumnHeaders(myList, selector);

                    for (var i = 0; i < myList.length; i++) {
                        var row$ = $('<tr/>');
                        for (var colIndex = 0; colIndex < columns.length; colIndex++) {
                            var cellValue = myList[i][columns[colIndex]];
                            if (cellValue == null) cellValue = "";
                            row$.append($('<td/>').html(cellValue));
                        }
                        $(selector).append(row$);
                    }
                }


                function addAllColumnHeaders(myList, selector) {
                    var columnSet = [];
                    var headerTr$ = $('<tr/>');

                    for (var i = 0; i < myList.length; i++) {
                        var rowHash = myList[i];
                        for (var key in rowHash) {
                            if ($.inArray(key, columnSet) == -1) {
                                columnSet.push(key);
                                headerTr$.append($('<th/>').html(key));
                            }
                        }
                    }
                    $(selector).append(headerTr$);

                    return columnSet;
                }
                document.getElementById("results").innerHTML = "";
                buildHtmlTable(document.getElementById("results"))


                var time = (after - before).toFixed(2);
                document.getElementById("timing").innerText = `Lookup took ${time} milliseconds.`

            }
            textInput.addEventListener("keypress", updateTable)
            textInput.addEventListener("keydown", updateTable)
        }
        run();
    </script>
</head>

<body>
    <div class="row">
        <div class="col-sm-4"></div>
        <div class="col-sm-4">
            <b>Fuzzy language lookup</b>
        </div>
        <div class="col-sm-4"></div>
    </div>
    <hr />
    <div class="row">
        <div class="col-sm-2"></div>
        <div id="ques" class="col-sm-4">Type a language name with with some spelling errors:</div>
        <div class="col-sm-4"></div>
        <div class="col-sm-2"></div>
    </div>
    <div class="row">
        <div class="col-sm-2"></div>
        <div class="col-sm-4">
            <input type="text" id="nameInput" placeholder="enxglxish" , value="enxglxish">
        </div>
        <div class="col-sm-4">
            <!-- <button class="bg-light" id="buttonOne">Â¡Search languages!</button> -->
        </div>
        <div class="col-sm-2"></div>
    </div>
    <br>
    <div id="timing"></div>
    </br>
    <div id="results"></div>
</body>
<script src="https://cdn.bootcdn.net/ajax/libs/jquery/3.4.1/jquery.js"
    integrity="sha256-WpOohJOqMqqyKL9FccASB9O0KwACQJpFTUBLTYOVvVU=" crossorigin="anonymous"></script>

</html>